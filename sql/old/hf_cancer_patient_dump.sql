-- WARNING: LARGE OUTPUT FILE
--
--
SELECT TOP 10
	fe.patient_id,
	fe.encounter_id,
	(CASE
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 140 AND 149) THEN '140-149.99: MALIGNANT NEOPLASM OF LIP, ORAL CAVITY, AND PHARYNX'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 150 AND 159) THEN '150-159.99: MALIGNANT NEOPLASM OF DIGESTIVE ORGANS AND PERITONEUM'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 160 AND 165) THEN '160-165.99: MALIGNANT NEOPLASM OF RESPIRATORY AND INTRATHORACIC ORGANS'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 170 AND 176) THEN '170-176.99: MALIGNANT NEOPLASM OF BONE, CONNECTIVE TISSUE, SKIN, AND BREAST'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 179 AND 189) THEN '179-189.99: MALIGNANT NEOPLASM OF GENITOURINARY ORGANS'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 190 AND 199) THEN '190-199.99: MALIGNANT NEOPLASM OF OTHER AND UNSPECIFIED SITES'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 200 AND 208) THEN '200-208.99: MALIGNANT NEOPLASM OF LYMPHATIC AND HEMATOPOIETIC TISSUE'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 209 AND 209) THEN '209-209.99: NEUROENDOCRINE TUMORS'
	WHEN (CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 230 AND 234) THEN '230-234.99: CARCINOMA IN SITU'
	ELSE 'ERROR'
	END) AS cancer_class,
	(CASE  
	WHEN fe.age_in_years BETWEEN  0 AND 17 THEN '00-17'
	WHEN fe.age_in_years BETWEEN 18 AND 64 THEN '18-64'
	WHEN fe.age_in_years >= 65 THEN '65+'
	ELSE 'Unknown'
	END) AS agerange,
	(CASE
	WHEN fe.weight IS NULL THEN 'NULL'
	WHEN fe.weight BETWEEN 0 AND  100 THEN '000-100'
	WHEN fe.weight BETWEEN 100 AND 150 THEN '100-150'
	WHEN fe.weight BETWEEN 150 AND 200 THEN '150-200'
	WHEN fe.weight BETWEEN 200 AND 250 THEN '200-250'
	WHEN fe.weight BETWEEN 250 AND 300 THEN '250-300'
	WHEN fe.weight > 300 THEN '300+'
	ELSE 'ERROR'
	END) AS weightrange
FROM
	hf_f_diagnosis fd
JOIN
	hf_f_encounter fe ON fd.encounter_id = fe.encounter_id
JOIN
	hf_d_diagnosis dd ON fd.diagnosis_id = dd.diagnosis_id
JOIN
       	hf_d_diagnosis_type ddt ON fd.diagnosis_type_id = ddt.diagnosis_type_id
WHERE
	fe.admitted_dt_tm BETWEEN CAST('2013-01-01' AS date) AND CAST('2013-12-31' AS date)
	AND dd.diagnosis_code LIKE '[0-9][0-9][0-9].%'
	AND ( CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 140 AND 209
		OR CAST(SUBSTRING(dd.diagnosis_code,1,3) AS INTEGER) BETWEEN 230 AND 234
	)
       	AND ddt.diagnosis_type_display = 'Final'
	;
--
